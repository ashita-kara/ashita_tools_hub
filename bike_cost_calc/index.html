<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç¶­æŒè²»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ Pro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
    :root { --primary: #00c853; --accent: #2962ff; --bg: #f4f7f6; --text: #333; }
    body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; line-height: 1.5; }
    .container { max-width: 800px; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; padding-bottom: 20px; }
    
    header { background: var(--primary); color: #fff; padding: 20px; text-align: center; }
    h1 { margin: 0; font-size: 20px; font-weight: bold; }
    
    /* å…¥åŠ›ã‚¨ãƒªã‚¢å…±é€š */
    .section-title { background: #e8f5e9; padding: 15px; font-weight: bold; color: #2e7d32; border-bottom: 1px solid #c8e6c9; cursor: pointer; display: flex; justify-content: space-between; }
    .section-content { display: none; padding: 15px; border-bottom: 1px solid #eee; }
    .section-content.open { display: block; }
    .input-group { margin-bottom: 15px; border-bottom: 1px dashed #eee; padding-bottom: 10px; }
    .label-row { display: flex; justify-content: space-between; font-size: 14px; font-weight: bold; }
    .input-row { display: flex; align-items: center; gap: 5px; margin-top: 5px; }
    input, select { padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 100%; text-align: right; font-size: 16px; box-sizing: border-box; }
    .unit { font-size: 12px; color: #666; white-space: nowrap; }

    /* çµæœã‚¨ãƒªã‚¢ (ã“ã“ã ã‘ã‚¹ã‚¯ã‚·ãƒ§ã™ã‚‹) */
    .result-area { background: #263238; color: #fff; padding: 30px 20px; text-align: center; border-radius: 0; }
    
    /* â˜…è¿½åŠ ï¼šé»’æ å†…ã®ãƒã‚¤ã‚¯åè¡¨ç¤º */
    .display-bike-name { 
        font-size: 28px; 
        font-weight: bold; 
        color: #fff; 
        border: 2px solid #fff; 
        display: inline-block;
        padding: 5px 20px;
        margin-bottom: 20px;
        border-radius: 4px;
        min-width: 200px;
    }

    .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
    .result-box { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; }
    .result-label { font-size: 12px; opacity: 0.7; }
    .result-value { font-size: 18px; font-weight: bold; margin-top: 5px; }
    .total-cost { font-size: 36px; font-weight: bold; color: #00e676; margin: 10px 0; }
    
    .chart-container { background: #fff; margin: 15px 0; padding: 10px; border-radius: 8px; }
    
    /* ãƒœã‚¿ãƒ³ã¨åå‰å…¥åŠ›ã‚¨ãƒªã‚¢ */
    .action-area { padding: 20px; background: #e3f2fd; border-top: 1px solid #bbdefb; text-align: center; }
    .name-input-wrap { margin-bottom: 15px; text-align: left; max-width: 300px; margin: 0 auto 15px; }
    .name-input-label { font-size: 12px; color: #1565c0; font-weight: bold; margin-bottom: 4px; display: block; }
    #myBikeNameInput { text-align: center; border: 2px solid #2962ff; color: #2962ff; font-weight: bold; }

    .btn-ss { background: var(--accent); color: #fff; border: none; padding: 12px 30px; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2); width: 100%; max-width: 300px; }
    .btn-ss:active { transform: scale(0.95); }

    /* ãã®ä»– */
    .toggle-container { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 10px; font-size: 12px; }
    .switch { position: relative; display: inline-block; width: 40px; height: 22px; margin-left: 8px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--accent); }
    input:checked + .slider:before { transform: translateX(18px); }
</style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ›µ ç¶­æŒè²»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    </header>

    <div style="padding:15px; border-bottom:1px solid #eee;">
        <select id="presetSelect" onchange="loadPreset()">
            <option value="custom">â–¼ è»Šç¨®ã‚’é¸æŠã—ã¦è‡ªå‹•å…¥åŠ›</option>
            <optgroup label="HONDA">
                <option value="pcx125">PCX 125</option>
                <option value="pcx160">PCX 160</option>
                <option value="adv160">ADV 160</option>
                <option value="lead125">ãƒªãƒ¼ãƒ‰ 125</option>
                <option value="ct125">CT125 ãƒãƒ³ã‚¿ãƒ¼ã‚«ãƒ–</option>
                <option value="c125">ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ– C125</option>
                <option value="benly110">ãƒ™ãƒ³ãƒªã‚£ 110</option>
                <option value="canopy">ã‚¸ãƒ£ã‚¤ãƒ­ã‚­ãƒ£ãƒãƒ”ãƒ¼</option>
            </optgroup>
            <optgroup label="YAMAHA">
                <option value="nmax125">NMAX 125</option>
                <option value="tricity125">ãƒˆãƒªã‚·ãƒ†ã‚£ 125</option>
                <option value="gryphus">ã‚·ã‚°ãƒŠã‚¹ ã‚°ãƒªãƒ•ã‚¡ã‚¹</option>
            </optgroup>
            <optgroup label="SUZUKI">
                <option value="address">ã‚¢ãƒ‰ãƒ¬ã‚¹ 125</option>
            </optgroup>
        </select>
    </div>

    <div class="result-area" id="resultBox">
        <div class="display-bike-name" id="displayBikeName">YOUR BIKE</div>

        <div class="result-label">å¹´é–“ ç¶­æŒè²»åˆè¨ˆ</div>
        <div class="total-cost" id="resTotalYear">0 å††</div>
        
        <div class="chart-container">
            <canvas id="costChart"></canvas>
        </div>
        <div style="font-size:10px; color:#aaa; margin-top:5px;">â€»ã‚°ãƒ©ãƒ•æ¯”è¼ƒã«é§è»Šå ´ä»£ã¯å«ã¾ã‚Œã¾ã›ã‚“</div>

        <div class="result-grid">
            <div class="result-box">
                <div class="result-label">1kmã‚³ã‚¹ãƒˆ</div>
                <div class="result-value" id="resCostPerKm">0 å††</div>
            </div>
            <div class="result-box">
                <div class="result-label">æœˆæ›ç®—</div>
                <div class="result-value" id="resCostPerMonth">0 å††</div>
            </div>
            <div class="result-box">
                <div class="result-label">å¹´é–“è·é›¢</div>
                <div class="result-value" id="resAnnualKm">0 km</div>
            </div>
            <div class="result-box">
                <div class="result-label">1æ—¥ã‚ãŸã‚Š</div>
                <div class="result-value" id="resCostPerDay">0 å††</div>
            </div>
        </div>
        <div style="font-size:9px; color:#555; margin-top:15px; opacity:0.5;">Powered by Delivery Tools</div>
    </div>

    <div class="action-area" data-html2canvas-ignore="true">
        <div class="name-input-wrap">
            <label class="name-input-label">ç”»åƒä¿å­˜æ™‚ã«å…¥åŠ›ã—ã¦ãã ã•ã„</label>
            <input type="text" id="myBikeNameInput" placeholder="ä¾‹ï¼šå±‹æ ¹ä»˜ããƒˆãƒªã‚·ãƒ†ã‚£125" oninput="updateNameDisplay()">
        </div>
        <button class="btn-ss" onclick="takeScreenshot()">ğŸ“¸ ã“ã®å†…å®¹ã‚’ç”»åƒä¿å­˜ã™ã‚‹</button>
    </div>

    <div class="section-title active" onclick="toggleSection(this)">â‘  ç¨¼åƒãƒ»ç‡ƒè²»è¨­å®š</div>
    <div class="section-content open">
        <div class="input-group">
            <div class="label-row">1æ—¥ã®èµ°è¡Œè·é›¢ <span class="unit">km</span></div>
            <div class="input-row"><input type="number" id="dailyKm" value="100"></div>
        </div>
        <div class="input-group">
            <div class="label-row">é€±ã®ç¨¼åƒæ—¥æ•° <span class="unit">æ—¥</span></div>
            <div class="input-row"><input type="number" id="daysPerWeek" value="5"></div>
        </div>
        <div class="input-group">
            <div class="label-row">ã‚¬ã‚½ãƒªãƒ³ä¾¡æ ¼ <span class="unit">å††/L</span></div>
            <div class="input-row"><input type="number" id="gasPrice" value="170"></div>
        </div>
        <div class="input-group">
            <div class="label-row">å®Ÿç‡ƒè²» <span class="unit">km/L</span></div>
            <div class="input-row"><input type="number" id="mpg" value="45"></div>
        </div>
    </div>

    <div class="section-title" onclick="toggleSection(this)">â‘¡ å›ºå®šè²» (è»Šä¸¡ãƒ»ä¿é™º)</div>
    <div class="section-content">
        <div class="input-group">
            <div class="label-row">è»Šä¸¡ä¾¡æ ¼ï¼‹ã‚«ã‚¹ã‚¿ãƒ  <span class="unit">å††</span></div>
            <div class="input-row"><input type="number" id="bikePrice" value="380000"></div>
        </div>
        <div class="input-group">
            <div class="label-row">å„Ÿå´å¹´æ•° <span class="unit">å¹´</span></div>
            <div class="input-row"><input type="number" id="amortYears" value="3"></div>
        </div>
        <div class="input-group">
            <div class="label-row">ä¿é™ºãƒ»ç¨é‡‘ (å¹´é¡åˆè¨ˆ) <span class="unit">å††</span></div>
            <div class="input-row"><input type="number" id="fixedOtherYearly" value="35000"></div>
        </div>
        <div class="input-group">
            <div class="label-row">é§è»Šå ´ (æœˆé¡) <span class="unit">å††</span></div>
            <div class="input-row"><input type="number" id="parkPrice" value="0"></div>
        </div>
    </div>

    <div class="section-title" onclick="toggleSection(this)">â‘¢ æ¶ˆè€—å“ãƒ»ãƒ¡ãƒ³ãƒ†è²»</div>
    <div class="section-content">
        <div class="toggle-container">
            <span id="shopModeLabel">å·¥è³ƒè¾¼ã¿ãƒ¢ãƒ¼ãƒ‰</span>
            <label class="switch">
                <input type="checkbox" id="shopToggle" onchange="toggleShopMode()" checked>
                <span class="slider"></span>
            </label>
        </div>
        <div id="partsList"></div>
        <div class="input-group" style="margin-top:20px; border-top:2px solid #eee; padding-top:10px;">
             <div class="label-row">ãã®ä»–æ¶ˆè€—å“ (å¹´é¡æ¦‚ç®—)</div>
             <div class="input-row"><input type="number" id="miscYearly" value="20000"></div>
        </div>
    </div>

</div>

<script>
    const partsData = [
        { id: 'p_tireF', name: 'Fã‚¿ã‚¤ãƒ¤', cost: 6000, km: 15000, labor: 3000 },
        { id: 'p_tireR', name: 'Rã‚¿ã‚¤ãƒ¤', cost: 7000, km: 10000, labor: 4000 },
        { id: 'p_belt', name: 'Vãƒ™ãƒ«ãƒˆé§†å‹•ç³»', cost: 8000, km: 20000, labor: 6000 },
        { id: 'p_brake', name: 'å‰å¾Œãƒ–ãƒ¬ãƒ¼ã‚­', cost: 5000, km: 15000, labor: 4000 }
    ];

    const presets = {
        pcx125: { name:"PCX125", mpg:48, price:360000 },
        tricity125: { name:"ãƒˆãƒªã‚·ãƒ†ã‚£125", mpg:38, price:450000 },
        canopy: { name:"ã‚¸ãƒ£ã‚¤ãƒ­ã‚­ãƒ£ãƒãƒ”ãƒ¼", mpg:35, price:580000 },
        c125: { name:"ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ–C125", mpg:65, price:440000 },
        custom: { name:"YOUR BIKE", mpg:45, price:300000 }
    };

    const avgData = { mpg: 45, costPerKm: 7.5 };
    let costChart = null;

    function init() {
        const container = document.getElementById('partsList');
        partsData.forEach(p => {
            container.innerHTML += `
            <div class="input-group">
                <div class="label-row">${p.name}</div>
                <div class="input-row"><span class="unit">éƒ¨å“</span><input type="number" id="${p.id}_cost" value="${p.cost}" class="recalc"></div>
                <div class="input-row labor-row"><span class="unit" style="color:blue">å·¥è³ƒ</span><input type="number" id="${p.id}_labor" value="${p.labor}" class="recalc"></div>
                <div class="input-row"><span class="unit">äº¤æ›km</span><input type="number" id="${p.id}_km" value="${p.km}" class="recalc"></div>
            </div>`;
        });

        document.querySelectorAll('input, select').forEach(el => {
            if(el.id !== 'myBikeNameInput') el.addEventListener('input', calculate);
        });
        
        calculate();
    }

    function calculate() {
        const dailyKm = Number(document.getElementById('dailyKm').value);
        const daysWeek = Number(document.getElementById('daysPerWeek').value);
        const annualKm = dailyKm * daysWeek * 52;

        const bikePrice = Number(document.getElementById('bikePrice').value);
        const amortYears = Number(document.getElementById('amortYears').value);
        const fixedOther = Number(document.getElementById('fixedOtherYearly').value);
        const parkMonthly = Number(document.getElementById('parkPrice').value);
        
        const depreciation = bikePrice / amortYears;
        const parkingYearly = parkMonthly * 12;
        const fixedYearly = depreciation + fixedOther + parkingYearly;

        const gasPrice = Number(document.getElementById('gasPrice').value);
        const mpg = Number(document.getElementById('mpg').value) || 1;
        const fuelYearly = (annualKm / mpg) * gasPrice;

        const miscYearly = Number(document.getElementById('miscYearly').value);
        const isShop = document.getElementById('shopToggle').checked;
        let partsYearly = 0;
        
        partsData.forEach(p => {
            const cost = Number(document.getElementById(p.id + '_cost').value);
            const labor = isShop ? Number(document.getElementById(p.id + '_labor').value) : 0;
            const km = Number(document.getElementById(p.id + '_km').value) || 999999;
            partsYearly += ((cost + labor) / km) * annualKm;
        });

        const totalYearly = fixedYearly + fuelYearly + miscYearly + partsYearly;
        const costPerKm = annualKm > 0 ? totalYearly / annualKm : 0;

        document.getElementById('resAnnualKm').innerText = Math.round(annualKm).toLocaleString() + ' km';
        document.getElementById('resTotalYear').innerText = Math.round(totalYearly).toLocaleString() + ' å††';
        document.getElementById('resCostPerMonth').innerText = Math.round(totalYearly/12).toLocaleString() + ' å††';
        document.getElementById('resCostPerDay').innerText = Math.round(totalYearly/(daysWeek*52)).toLocaleString() + ' å††';
        document.getElementById('resCostPerKm').innerText = (Math.round(costPerKm * 10) / 10).toLocaleString() + ' å††';

        const pureCostYearly = totalYearly - parkingYearly;
        const pureCostPerKm = annualKm > 0 ? pureCostYearly / annualKm : 0;
        updateChart(mpg, pureCostPerKm);
    }

    function updateChart(userMpg, userCostPerKm) {
        const ctx = document.getElementById('costChart').getContext('2d');
        if (costChart) costChart.destroy();

        costChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['ç‡ƒè²» (km/L)', '1kmç¶­æŒè²» (å††)'],
                datasets: [
                    {
                        label: 'ã‚ãªãŸã®ãƒã‚¤ã‚¯',
                        data: [userMpg, userCostPerKm],
                        backgroundColor: ['#2962ff', '#00c853'],
                        borderWidth: 1
                    },
                    {
                        label: 'å¹³å‡ (125cc)',
                        data: [avgData.mpg, avgData.costPerKm],
                        backgroundColor: '#cfd8dc',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    title: { display: true, text: 'å¹³å‡ãƒ‡ãƒ¼ã‚¿ã¨ã®æ¯”è¼ƒ' }
                },
                scales: { y: { beginAtZero: true } }
            }
        });
    }

    // åå‰å…¥åŠ›ã®åæ˜ 
    function updateNameDisplay() {
        const inputVal = document.getElementById('myBikeNameInput').value;
        const display = document.getElementById('displayBikeName');
        display.innerText = inputVal === '' ? 'YOUR BIKE' : inputVal;
    }

    // ã‚¹ã‚¯ã‚·ãƒ§ä¿å­˜
    function takeScreenshot() {
        const target = document.getElementById('resultBox'); // é»’ã„ãƒœãƒƒã‚¯ã‚¹ã®ã¿æŒ‡å®š
        
        html2canvas(target, {
            scale: 2, // é«˜ç”»è³ªåŒ–
            backgroundColor: "#263238" // èƒŒæ™¯è‰²æŒ‡å®š
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'bike_cost_result.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function toggleSection(el) {
        el.classList.toggle('active');
        el.nextElementSibling.classList.toggle('open');
    }
    function toggleShopMode() {
        const isShop = document.getElementById('shopToggle').checked;
        document.querySelectorAll('.labor-row').forEach(row => {
            row.style.display = isShop ? 'flex' : 'none';
        });
        calculate();
    }
    function loadPreset() {
        const val = document.getElementById('presetSelect').value;
        const data = presets[val];
        if(data && val !== 'custom') {
            document.getElementById('mpg').value = data.mpg;
            document.getElementById('bikePrice').value = data.price;
            
            // å…¥åŠ›æ¬„ã¨è¡¨ç¤ºã®ä¸¡æ–¹ã‚’æ›´æ–°
            document.getElementById('myBikeNameInput').value = data.name;
            document.getElementById('displayBikeName').innerText = data.name;
            
            calculate();
        }
    }

    init();
</script>

</body>
</html>