<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç¶­æŒè²»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ Pro (UI Layout Fix)</title>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
    :root { --primary: #00c853; --accent: #2962ff; --bg: #f4f7f6; --text: #333; }
    body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; line-height: 1.5; }
    .container { max-width: 800px; margin: 0 auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow: hidden; padding-bottom: 20px; }
    
    header { background: var(--primary); color: #fff; padding: 20px; text-align: center; }
    h1 { margin: 0; font-size: 20px; font-weight: bold; }

    /* ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠã‚¨ãƒªã‚¢ï¼ˆç§»å‹•ã«ä¼´ã„èƒŒæ™¯è‰²ãªã©ã‚’å¾®èª¿æ•´ï¼‰ */
    .preset-area { background: #eceff1; padding: 15px; text-align: center; border-bottom: 1px solid #ddd; }
    .preset-select { width: 100%; max-width: 400px; padding: 10px; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; background: #fff; color: #333; font-weight: bold; }
    
    /* å…¥åŠ›ã‚¨ãƒªã‚¢å…±é€š */
    .section-title { background: #e8f5e9; padding: 15px; font-weight: bold; color: #2e7d32; border-bottom: 1px solid #c8e6c9; cursor: pointer; display: flex; justify-content: space-between; }
    .section-content { display: none; padding: 15px; border-bottom: 1px solid #eee; }
    .section-content.open { display: block; }
    .input-group { margin-bottom: 15px; border-bottom: 1px dashed #eee; padding-bottom: 10px; transition: opacity 0.3s; }
    .label-row { display: flex; justify-content: space-between; align-items: center; font-size: 14px; font-weight: bold; }
    .input-row { display: flex; align-items: center; gap: 5px; margin-top: 5px; }
    input, select { padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 100%; text-align: right; font-size: 16px; box-sizing: border-box; }
    .unit { font-size: 12px; color: #666; white-space: nowrap; min-width: 30px; text-align: right; }
    .sub-label { font-size: 11px; color: #888; margin-bottom: 2px; }

    /* ç„¡åŠ¹åŒ–æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .disabled-part { opacity: 0.5; } 
    
    .opt-check-label { font-size: 11px; color: #d32f2f; font-weight: normal; margin-left: 10px; display: flex; align-items: center; cursor: pointer; }
    .opt-check-label input { width: auto; margin-right: 4px; cursor: pointer; }

    /* æ¶²ä½“è¨ˆç®—ç”¨ã‚¨ãƒªã‚¢ */
    .liquid-area { background: #f9f9f9; padding: 8px; border-radius: 6px; margin-top: 5px; border: 1px solid #eee; }
    .liquid-row { display: flex; gap: 10px; }
    .liquid-col { flex: 1; }
    .liquid-label { font-size: 10px; color: #555; display: block; }

    /* çµæœã‚¨ãƒªã‚¢ */
    .result-area { background: #263238; color: #fff; padding: 30px 20px; text-align: center; border-radius: 0; }
    
    .display-bike-name { 
        font-size: 28px; font-weight: bold; color: #fff; 
        border: 2px solid #fff; display: inline-block;
        padding: 5px 20px; margin-bottom: 20px;
        border-radius: 4px; min-width: 200px;
    }

    .result-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
    .result-box { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; }
    .result-label { font-size: 12px; opacity: 0.7; }
    .result-value { font-size: 18px; font-weight: bold; margin-top: 5px; }
    .total-cost { font-size: 36px; font-weight: bold; color: #00e676; margin: 10px 0; }
    
    .action-area { padding: 20px; background: #e3f2fd; border-top: 1px solid #bbdefb; text-align: center; }
    .name-input-wrap { margin-bottom: 15px; text-align: left; max-width: 300px; margin: 0 auto 15px; }
    .name-input-label { font-size: 12px; color: #1565c0; font-weight: bold; margin-bottom: 4px; display: block; }
    #myBikeNameInput { text-align: center; border: 2px solid #2962ff; color: #2962ff; font-weight: bold; }

    .btn-ss { background: var(--accent); color: #fff; border: none; padding: 12px 30px; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2); width: 100%; max-width: 300px; }
    .btn-ss:active { transform: scale(0.95); }

    .toggle-container { display: flex; justify-content: flex-end; align-items: center; margin-bottom: 10px; font-size: 12px; }
    .switch { position: relative; display: inline-block; width: 40px; height: 22px; margin-left: 8px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--accent); }
    input:checked + .slider:before { transform: translateX(18px); }

    .category-header { background: #f5f5f5; padding: 5px 10px; font-size: 12px; font-weight:bold; color:#555; margin-top:15px; border-left: 4px solid #aaa; }
</style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ›µ ç¶­æŒè²»ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ Pro</h1>
    </header>

    <div class="result-area" id="resultBox">
        <div class="display-bike-name" id="displayBikeName">YOUR BIKE</div>

        <div class="result-label">å¹´é–“ ç¶­æŒè²»åˆè¨ˆ</div>
        <div class="total-cost" id="resTotalYear">0 å††</div>

        <div class="result-grid">
            <div class="result-box">
                <div class="result-label">1kmã‚³ã‚¹ãƒˆ</div>
                <div class="result-value" id="resCostPerKm">0 å††</div>
            </div>
            <div class="result-box">
                <div class="result-label">æœˆæ›ç®—</div>
                <div class="result-value" id="resCostPerMonth">0 å††</div>
            </div>
            <div class="result-box">
                <div class="result-label">å¹´é–“è·é›¢</div>
                <div class="result-value" id="resAnnualKm">0 km</div>
            </div>
            <div class="result-box">
                <div class="result-label">1æ—¥ã‚ãŸã‚Š</div>
                <div class="result-value" id="resCostPerDay">0 å††</div>
            </div>
        </div>
        <div style="font-size:9px; color:#555; margin-top:15px; opacity:0.5;">Powered by Delivery Tools</div>
    </div>

    <div class="action-area" data-html2canvas-ignore="true">
        <div class="name-input-wrap">
            <label class="name-input-label">ç”»åƒä¿å­˜æ™‚ã«å…¥åŠ›ã—ã¦ãã ã•ã„</label>
            <input type="text" id="myBikeNameInput" placeholder="ä¾‹ï¼šå±‹æ ¹ä»˜ããƒˆãƒªã‚·ãƒ†ã‚£125" oninput="updateNameDisplay()">
        </div>
        <button class="btn-ss" onclick="takeScreenshot()">ğŸ“¸ ã“ã®å†…å®¹ã‚’ç”»åƒä¿å­˜ã™ã‚‹</button>
    </div>

    <div class="preset-area">
        <select id="presetSelect" class="preset-select" onchange="loadPreset()">
            <option value="">â–¼ è»Šç¨®ã‚’é¸æŠã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰</option>
            <optgroup label="HONDA">
                <option value="pcx125">PCX 125</option>
                <option value="pcx160">PCX 160</option>
                <option value="adv160">ADV 160</option>
                <option value="forza125">FORZA 125</option>
                <option value="lead125">ãƒªãƒ¼ãƒ‰ 125</option>
                <option value="dio110">Dio 110</option>
                <option value="benly110">ãƒ™ãƒ³ãƒªã‚£ 110</option>
                <option value="c125">ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ– C125</option>
                <option value="ct125">CT125 ãƒãƒ³ã‚¿ãƒ¼ã‚«ãƒ–</option>
                <option value="gyro">ã‚¸ãƒ£ã‚¤ãƒ­ã‚­ãƒ£ãƒãƒ”ãƒ¼/X</option>
                <option value="tact">ã‚¿ã‚¯ãƒˆ/ãƒ€ãƒ³ã‚¯/ã‚ºãƒ¼ãƒãƒ¼ (50cc)</option>
            </optgroup>
            <optgroup label="YAMAHA">
                <option value="nmax125">NMAX 125</option>
                <option value="nmax155">NMAX 155</option>
                <option value="tricity125">ãƒˆãƒªã‚·ãƒ†ã‚£ 125 (ãƒ•ãƒ­ãƒ³ãƒˆ2è¼ª)</option>
                <option value="tricity155">ãƒˆãƒªã‚·ãƒ†ã‚£ 155 (ãƒ•ãƒ­ãƒ³ãƒˆ2è¼ª)</option>
                <option value="cygnus">ã‚·ã‚°ãƒŠã‚¹ ã‚°ãƒªãƒ•ã‚¡ã‚¹</option>
                <option value="xforce">X FORCE</option>
                <option value="axisz">ã‚¢ã‚¯ã‚·ã‚¹Z / JOG125</option>
                <option value="jog">JOG / VINO (50cc)</option>
            </optgroup>
            <optgroup label="SUZUKI">
                <option value="address125">ã‚¢ãƒ‰ãƒ¬ã‚¹ 125</option>
                <option value="avenis125">ã‚¢ãƒ´ã‚§ãƒ‹ã‚¹ 125</option>
                <option value="burgman">ãƒãƒ¼ã‚°ãƒãƒ³ã‚¹ãƒˆãƒªãƒ¼ãƒˆ125EX</option>
                <option value="address110">ã‚¢ãƒ‰ãƒ¬ã‚¹ 110</option>
                <option value="lets">ãƒ¬ãƒƒãƒ„ (50cc)</option>
            </optgroup>
        </select>
        <div style="font-size:11px; color:#666; margin-top:5px;">â€»é¸æŠã™ã‚‹ã¨å¹³å‡ãƒ‡ãƒ¼ã‚¿ãŒè‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ï¼ˆè»Šåã¯ç¶­æŒã•ã‚Œã¾ã™ï¼‰</div>
    </div>

    <div class="section-title active" onclick="toggleSection(this)">â‘  ç¨¼åƒãƒ»ç‡ƒè²»è¨­å®š</div>
    <div class="section-content open">
        <div class="input-group">
            <div class="label-row">1æ—¥ã®èµ°è¡Œè·é›¢ <span class="unit">km</span></div>
            <div class="input-row"><input type="number" id="dailyKm" value="100"></div>
        </div>
        <div class="input-group">
            <div class="label-row">é€±ã®ç¨¼åƒæ—¥æ•° <span class="unit">æ—¥</span></div>
            <div class="input-row"><input type="number" id="daysPerWeek" value="5"></div>
        </div>
        <div class="input-group">
            <div class="label-row">ã‚¬ã‚½ãƒªãƒ³ä¾¡æ ¼ <span class="unit">å††/L</span></div>
            <div class="input-row"><input type="number" id="gasPrice" value="170"></div>
        </div>
        <div class="input-group">
            <div class="label-row">å®Ÿç‡ƒè²» <span class="unit">km/L</span></div>
            <div class="input-row"><input type="number" id="mpg" value="45"></div>
        </div>
    </div>

    <div class="section-title" onclick="toggleSection(this)">â‘¡ å›ºå®šè²» (è»Šä¸¡ãƒ»ä¿é™ºãƒ»ç¨é‡‘)</div>
    <div class="section-content">
        
        <div class="category-header">è»Šä¸¡æœ¬ä½“ãƒ»å„Ÿå´</div>
        <div class="input-group">
            <div class="label-row">è»Šä¸¡æœ¬ä½“ä¾¡æ ¼ <span class="unit">å††</span></div>
            <div class="sub-label">â€»ä¸­å¤2å¹´ã€æ–°è»Š3å¹´ãªã©</div>
            <div class="input-row"><input type="number" id="bikeBodyPrice" value="380000"></div>
        </div>
        <div class="input-group">
            <div class="label-row">ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼ç·é¡ <span class="unit">å††</span></div>
            <div class="sub-label">â€»ç®±ã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã€è£…å‚™å“ãªã©</div>
            <div class="input-row"><input type="number" id="accessoriesPrice" value="50000"></div>
        </div>
        <div class="input-group">
            <div class="label-row">å„Ÿå´äºˆå®šå¹´æ•° <span class="unit">å¹´</span></div>
            <div class="input-row"><input type="number" id="amortYears" value="3"></div>
        </div>

        <div class="category-header">ä¿é™ºãƒ»ç¨é‡‘</div>
        <div class="input-group">
            <div class="label-row">è‡ªè³ è²¬ä¿é™º (ç·é¡) <span class="unit">å††</span></div>
            <div class="input-row"><input type="number" id="jibaisekiPrice" value="14200"></div>
            <div class="input-row" style="margin-top:5px;">
                <select id="jibaisekiYears">
                    <option value="1">1å¹´åˆ†ã¨ã—ã¦è¨ˆç®—</option>
                    <option value="2">2å¹´åˆ†ã¨ã—ã¦è¨ˆç®—</option>
                    <option value="3">3å¹´åˆ†ã¨ã—ã¦è¨ˆç®—</option>
                    <option value="4">4å¹´åˆ†ã¨ã—ã¦è¨ˆç®—</option>
                    <option value="5" selected>5å¹´åˆ†ã¨ã—ã¦è¨ˆç®—</option>
                </select>
            </div>
        </div>
        <div class="input-group">
            <div class="label-row">ä»»æ„ä¿é™º (å¹´é¡) <span class="unit">å††</span></div>
            <div class="input-row"><input type="number" id="arbitraryInsurance" value="25000"></div>
        </div>
        <div class="input-group">
            <div class="label-row">è»½è‡ªå‹•è»Šç¨ (å¹´é¡) <span class="unit">å††</span></div>
            <div class="input-row"><input type="number" id="taxYearly" value="2400"></div>
        </div>

        <div class="category-header">é§è»Šå ´</div>
        <div class="input-group">
            <div class="label-row">é§è»Šå ´ (æœˆé¡) <span class="unit">å††</span></div>
            <div class="input-row"><input type="number" id="parkMonthly" value="0"></div>
        </div>
        <div class="input-group">
            <div class="label-row">é§è»Šå ´æ›´æ–°æ–™ (å¹´æ›ç®—) <span class="unit">å††</span></div>
            <div class="input-row"><input type="number" id="parkRenewalYearly" value="0"></div>
        </div>
    </div>

    <div class="section-title" onclick="toggleSection(this)">â‘¢ æ¶ˆè€—å“ãƒ»ãƒ¡ãƒ³ãƒ†è²»</div>
    <div class="section-content">
        <div class="toggle-container">
            <span id="shopModeLabel">å·¥è³ƒè¾¼ã¿ãƒ¢ãƒ¼ãƒ‰</span>
            <label class="switch">
                <input type="checkbox" id="shopToggle" onchange="toggleShopMode()" checked>
                <span class="slider"></span>
            </label>
        </div>
        
        <div id="partsList"></div>
    </div>

</div>

<script>
    const partsData = [
        // â–¼ æ¶²ä½“ç³»
        { type: 'liquid', category: "ã‚ªã‚¤ãƒ«ãƒ»æ¶²ä½“é¡", id: 'p_oil', name: 'ã‚¨ãƒ³ã‚¸ãƒ³ã‚ªã‚¤ãƒ«', buyPrice: 3000, buyVol: 1, useVol: 0.8, life: 3000, labor: 1000 },
        { type: 'liquid', category: "ã‚ªã‚¤ãƒ«ãƒ»æ¶²ä½“é¡", id: 'p_additive', name: 'ç‡ƒæ–™æ·»åŠ å‰¤', buyPrice: 1500, buyVol: 300, useVol: 50, life: 5000, labor: 0, optional: true },
        { type: 'liquid', category: "ã‚ªã‚¤ãƒ«ãƒ»æ¶²ä½“é¡", id: 'p_coolant', name: 'ã‚¯ãƒ¼ãƒ©ãƒ³ãƒˆ(å†·å´æ°´)', buyPrice: 2000, buyVol: 2, useVol: 1.5, life: 20000, labor: 3000, optional: true },
        { type: 'liquid', category: "ã‚ªã‚¤ãƒ«ãƒ»æ¶²ä½“é¡", id: 'p_brkFluid', name: 'ãƒ–ãƒ¬ãƒ¼ã‚­ãƒ•ãƒ«ãƒ¼ãƒ‰', buyPrice: 1500, buyVol: 500, useVol: 200, life: 15000, labor: 3000, optional: true },

        // â–¼ é€šå¸¸æ¶ˆè€—å“
        { type: 'normal', category: "åŸºæœ¬æ¶ˆè€—å“", id: 'p_oil_element', name: 'ã‚ªã‚¤ãƒ«ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ', cost: 1000, life: 6000, labor: 1000, optional: true },
        { type: 'normal', category: "åŸºæœ¬æ¶ˆè€—å“", id: 'p_air_element', name: 'ã‚¨ã‚¢ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆ', cost: 2000, life: 15000, labor: 1500, optional: true },
        { type: 'normal', category: "åŸºæœ¬æ¶ˆè€—å“", id: 'p_drain', name: 'ãƒ‰ãƒ¬ãƒ³ãƒ‘ãƒƒã‚­ãƒ³', cost: 100, life: 3000, labor: 0 },
        { type: 'normal', category: "åŸºæœ¬æ¶ˆè€—å“", id: 'p_discard', name: 'ã‚ªã‚¤ãƒ«å»ƒæ£„ãƒ‘ãƒƒã‚¯', cost: 300, life: 3000, labor: 0 },
        
        // é›»è£…ãƒ»ç‚¹ç«
        { type: 'normal', category: "é›»è£…ãƒ»ç‚¹ç«ãƒ»ã‚¿ã‚¤ãƒ¤", id: 'p_battery', name: 'ãƒãƒƒãƒ†ãƒªãƒ¼', cost: 8000, life: 2, labor: 2000, optional: true, mode: 'time' },
        { type: 'normal', category: "é›»è£…ãƒ»ç‚¹ç«ãƒ»ã‚¿ã‚¤ãƒ¤", id: 'p_plug', name: 'ç‚¹ç«ãƒ—ãƒ©ã‚°', cost: 1200, life: 10000, labor: 1500 },
        
        // ã‚¿ã‚¤ãƒ¤
        { type: 'normal', category: "é›»è£…ãƒ»ç‚¹ç«ãƒ»ã‚¿ã‚¤ãƒ¤", id: 'p_tireF', name: 'Fã‚¿ã‚¤ãƒ¤', cost: 6000, life: 15000, labor: 3000 },
        { type: 'normal', category: "é›»è£…ãƒ»ç‚¹ç«ãƒ»ã‚¿ã‚¤ãƒ¤", id: 'p_tireR', name: 'Rã‚¿ã‚¤ãƒ¤', cost: 7000, life: 10000, labor: 4000 },
        
        // ãƒ–ãƒ¬ãƒ¼ã‚­
        { type: 'normal', category: "ãƒ–ãƒ¬ãƒ¼ã‚­", id: 'p_padF', name: 'Fãƒ–ãƒ¬ãƒ¼ã‚­ãƒ‘ãƒƒãƒ‰/ã‚·ãƒ¥ãƒ¼', cost: 4000, life: 15000, labor: 2000 },
        { type: 'normal', category: "ãƒ–ãƒ¬ãƒ¼ã‚­", id: 'p_padR', name: 'Rãƒ–ãƒ¬ãƒ¼ã‚­ã‚·ãƒ¥ãƒ¼/ãƒ‘ãƒƒãƒ‰', cost: 4000, life: 15000, labor: 3000 },

        // é§†å‹•ç³»
        { type: 'normal', category: "é§†å‹•ç³»", id: 'p_belt', name: 'Vãƒ™ãƒ«ãƒˆ(ãƒã‚§ãƒ¼ãƒ³)', cost: 6000, life: 20000, labor: 5000 },
        { type: 'normal', category: "é§†å‹•ç³»", id: 'p_pulley', name: 'ãƒ—ãƒ¼ãƒªãƒ¼/ã‚¹ãƒ—ãƒ­ã‚±ãƒƒãƒˆ', cost: 6000, life: 30000, labor: 4000 },
        { type: 'normal', category: "é§†å‹•ç³»", id: 'p_wr', name: 'ã‚¦ã‚¨ã‚¤ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼', cost: 2000, life: 20000, labor: 3000, optional: true },
        { type: 'normal', category: "é§†å‹•ç³»", id: 'p_slide', name: 'ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ”ãƒ¼ã‚¹', cost: 1000, life: 20000, labor: 0, optional: true },
        { type: 'normal', category: "é§†å‹•ç³»", id: 'p_clutch', name: 'ã‚¯ãƒ©ãƒƒãƒã‚·ãƒ¥ãƒ¼', cost: 6000, life: 40000, labor: 3000 },
        { type: 'normal', category: "é§†å‹•ç³»", id: 'p_spring', name: 'ã‚¯ãƒ©ãƒƒãƒã‚¹ãƒ—ãƒªãƒ³ã‚°', cost: 1500, life: 40000, labor: 0 },
        { type: 'normal', category: "é§†å‹•ç³»", id: 'p_gasket', name: 'é§†å‹•ã‚«ãƒãƒ¼ãƒ‘ãƒƒã‚­ãƒ³', cost: 1500, life: 20000, labor: 500 }
    ];

    // â˜… å¹³å‡ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒªã‚»ãƒƒãƒˆ
    const bikePresets = {
        // --- æ°´å†·125-160ccã‚¹ã‚¯ãƒ¼ã‚¿ãƒ¼ (Standard) ---
        pcx125: { name:"PCX 125", mpg:48, price:363000, type:"scooter_liq" },
        pcx160: { name:"PCX 160", mpg:45, price:407000, type:"scooter_liq" },
        adv160: { name:"ADV 160", mpg:44, price:473000, type:"scooter_liq" },
        forza125: { name:"FORZA 125", mpg:42, price:520000, type:"scooter_liq" },
        nmax125: { name:"NMAX 125", mpg:46, price:379500, type:"scooter_liq" },
        nmax155: { name:"NMAX 155", mpg:44, price:423500, type:"scooter_liq" },
        cygnus: { name:"ã‚·ã‚°ãƒŠã‚¹ ã‚°ãƒªãƒ•ã‚¡ã‚¹", mpg:42, price:374000, type:"scooter_liq" },
        xforce: { name:"X FORCE", mpg:40, price:396000, type:"scooter_liq" },
        burgman: { name:"ãƒãƒ¼ã‚°ãƒãƒ³125EX", mpg:52, price:317900, type:"scooter_air_125" },
        lead125: { name:"ãƒªãƒ¼ãƒ‰ 125", mpg:49, price:341000, type:"scooter_liq" },

        // --- ãƒˆãƒªã‚·ãƒ†ã‚£ (2 Front Tires) ---
        tricity125: { name:"ãƒˆãƒªã‚·ãƒ†ã‚£ 125", mpg:38, price:495000, type:"tricity" },
        tricity155: { name:"ãƒˆãƒªã‚·ãƒ†ã‚£ 155", mpg:37, price:566500, type:"tricity" },

        // --- ç©ºå†·125ccã‚¹ã‚¯ãƒ¼ã‚¿ãƒ¼ ---
        dio110: { name:"Dio 110", mpg:54, price:253000, type:"scooter_air_125" },
        benly110: { name:"ãƒ™ãƒ³ãƒªã‚£ 110", mpg:45, price:290000, type:"scooter_air_125" },
        axisz: { name:"ã‚¢ã‚¯ã‚·ã‚¹Z / JOG125", mpg:51, price:280500, type:"scooter_air_125" },
        address125: { name:"ã‚¢ãƒ‰ãƒ¬ã‚¹ 125", mpg:50, price:273900, type:"scooter_air_125" },
        avenis125: { name:"ã‚¢ãƒ´ã‚§ãƒ‹ã‚¹ 125", mpg:50, price:284900, type:"scooter_air_125" },
        address110: { name:"ã‚¢ãƒ‰ãƒ¬ã‚¹ 110", mpg:48, price:225000, type:"scooter_air_125" },

        // --- 50ccã‚¹ã‚¯ãƒ¼ã‚¿ãƒ¼ ---
        tact: { name:"ã‚¿ã‚¯ãƒˆ/Dunk/Let's", mpg:58, price:198000, type:"scooter_50" },
        jog: { name:"JOG / VINO", mpg:58, price:181000, type:"scooter_50" },

        // --- ã‚«ãƒ–ç³» ---
        c125: { name:"ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ– C125", mpg:65, price:451000, type:"cub" },
        ct125: { name:"CT125 ãƒãƒ³ã‚¿ãƒ¼ã‚«ãƒ–", mpg:60, price:440000, type:"cub" },

        // --- 3è¼ª (Gyro) ---
        gyro: { name:"ã‚¸ãƒ£ã‚¤ãƒ­ã‚­ãƒ£ãƒãƒ”ãƒ¼/X", mpg:35, price:594000, type:"gyro" }
    };

    // ã‚¿ã‚¤ãƒ—åˆ¥æ¶ˆè€—å“è¨­å®š
    const typeSettings = {
        scooter_liq: {
            p_oil: { use: 0.8 },
            p_tireF: { cost: 7000 }, p_tireR: { cost: 8000 },
            p_belt: { cost: 7000, life: 20000 },
            p_coolant: { active: true },
            p_wr: { active: true }, p_slide: { active: true }
        },
        tricity: {
            p_oil: { use: 0.8 },
            p_tireF: { cost: 12000, labor: 6000 }, // Fã‚¿ã‚¤ãƒ¤2æœ¬åˆ†
            p_tireR: { cost: 8000 },
            p_belt: { cost: 7000, life: 20000 },
            p_coolant: { active: true },
            p_wr: { active: true }, p_slide: { active: true }
        },
        scooter_air_125: {
            p_oil: { use: 0.7 },
            p_tireF: { cost: 5000 }, p_tireR: { cost: 6000 },
            p_belt: { cost: 5000, life: 20000 },
            p_coolant: { active: false },
            p_wr: { active: true }, p_slide: { active: true }
        },
        scooter_50: {
            p_oil: { use: 0.6, life: 2000 }, 
            p_tireF: { cost: 4000 }, p_tireR: { cost: 4500 },
            p_belt: { cost: 4000, life: 15000 },
            p_coolant: { active: true },
            p_wr: { active: true }, p_slide: { active: true }
        },
        cub: {
            p_oil: { use: 0.8 },
            p_tireF: { cost: 5000 }, p_tireR: { cost: 6000 },
            p_belt: { cost: 3000, life: 15000 }, // ãƒã‚§ãƒ¼ãƒ³
            p_coolant: { active: false },
            p_wr: { active: false }, p_slide: { active: false },
            p_brkFluid: { active: true }
        },
        gyro: {
            p_oil: { use: 0.6 },
            p_tireF: { cost: 5000 }, 
            p_tireR: { cost: 12000, labor: 6000 }, // Rã‚¿ã‚¤ãƒ¤2æœ¬åˆ†
            p_belt: { cost: 6000, life: 15000 },
            p_coolant: { active: true },
            p_wr: { active: true }, p_slide: { active: true }
        }
    };

    function init() {
        const container = document.getElementById('partsList');
        let currentCategory = "";

        partsData.forEach(p => {
            if(p.category !== currentCategory) {
                container.innerHTML += `<div class="category-header">${p.category}</div>`;
                currentCategory = p.category;
            }

            let checkHtml = '';
            if(p.optional) {
                checkHtml = `<label class="opt-check-label"><input type="checkbox" id="${p.id}_disabled" onchange="togglePart('${p.id}')"> ãªã—</label>`;
            }

            let unitLabel = 'äº¤æ›km';
            let lifeStep = '1';
            if(p.mode === 'time') {
                unitLabel = 'äº¤æ›å¹´æ•°';
                lifeStep = '0.5';
            }

            if(p.type === 'liquid') {
                container.innerHTML += `
                <div class="input-group" id="group_${p.id}">
                    <div class="label-row">
                        <span>${p.name}</span>
                        ${checkHtml}
                    </div>
                    <div class="liquid-area">
                        <div class="liquid-row">
                            <div class="liquid-col">
                                <span class="liquid-label">è³¼å…¥ä¾¡æ ¼(å††)</span>
                                <input type="number" id="${p.id}_buyPrice" value="${p.buyPrice}" class="recalc">
                            </div>
                            <div class="liquid-col">
                                <span class="liquid-label">è³¼å…¥é‡(L/ml)</span>
                                <input type="number" id="${p.id}_buyVol" value="${p.buyVol}" class="recalc">
                            </div>
                            <div class="liquid-col">
                                <span class="liquid-label">1å›ä½¿ç”¨é‡</span>
                                <input type="number" id="${p.id}_useVol" value="${p.useVol}" class="recalc">
                            </div>
                        </div>
                    </div>
                    <div class="input-row labor-row"><span class="unit" style="color:blue">å·¥è³ƒ</span><input type="number" id="${p.id}_labor" value="${p.labor}" class="recalc"></div>
                    <div class="input-row"><span class="unit">${unitLabel}</span><input type="number" id="${p.id}_life" value="${p.life}" step="${lifeStep}" class="recalc"></div>
                </div>`;
            } else {
                container.innerHTML += `
                <div class="input-group" id="group_${p.id}">
                    <div class="label-row">
                        <span>${p.name}</span>
                        ${checkHtml}
                    </div>
                    <div class="input-row"><span class="unit">éƒ¨å“</span><input type="number" id="${p.id}_cost" value="${p.cost}" class="recalc"></div>
                    <div class="input-row labor-row"><span class="unit" style="color:blue">å·¥è³ƒ</span><input type="number" id="${p.id}_labor" value="${p.labor}" class="recalc"></div>
                    <div class="input-row"><span class="unit">${unitLabel}</span><input type="number" id="${p.id}_life" value="${p.life}" step="${lifeStep}" class="recalc"></div>
                </div>`;
            }
        });

        document.querySelectorAll('input, select').forEach(el => {
            if(el.id !== 'myBikeNameInput' && el.id !== 'presetSelect') el.addEventListener('input', calculate);
        });

        calculate();
    }

    // â˜…ä¿®æ­£: åå‰æ›´æ–°å‡¦ç†ã‚’å‰Šé™¤
    function loadPreset() {
        const key = document.getElementById('presetSelect').value;
        if(!key || !bikePresets[key]) return;

        const p = bikePresets[key];
        const type = typeSettings[p.type];

        // åŸºæœ¬æƒ…å ±ã®ã‚»ãƒƒãƒˆï¼ˆåå‰ã¯æ›´æ–°ã—ãªã„ï¼‰
        document.getElementById('mpg').value = p.mpg;
        document.getElementById('bikeBodyPrice').value = p.price;
        
        // â˜…ã“ã“ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆãƒ»å‰Šé™¤ã—ã¾ã—ãŸ
        // document.getElementById('myBikeNameInput').value = p.name;
        // document.getElementById('displayBikeName').innerText = p.name;

        // æ¶ˆè€—å“ã®ä¸€æ‹¬è¨­å®š
        if(type) {
            for (const [partId, settings] of Object.entries(type)) {
                if(settings.cost !== undefined) {
                    const el = document.getElementById(partId + '_cost');
                    if(el) el.value = settings.cost;
                }
                if(settings.labor !== undefined) {
                    const el = document.getElementById(partId + '_labor');
                    if(el) el.value = settings.labor;
                }
                if(settings.life !== undefined) {
                    const el = document.getElementById(partId + '_life');
                    if(el) el.value = settings.life;
                }
                if(settings.use !== undefined) {
                    const el = document.getElementById(partId + '_useVol');
                    if(el) el.value = settings.use;
                }
                if(settings.active !== undefined) {
                    setOptionalState(partId, settings);
                }
            }
        }
        calculate();
    }

    function setOptionalState(id, settings) {
        const checkbox = document.getElementById(id + '_disabled');
        if(!checkbox) return;

        const shouldBeDisabled = (settings.active === false);
        checkbox.checked = shouldBeDisabled;
        togglePart(id);
    }

    function togglePart(id) {
        const group = document.getElementById('group_' + id);
        const checkbox = document.getElementById(id + '_disabled');
        const inputs = group.querySelectorAll('input[type="number"]');

        if (checkbox.checked) {
            group.classList.add('disabled-part');
            inputs.forEach(input => input.disabled = true);
        } else {
            group.classList.remove('disabled-part');
            inputs.forEach(input => input.disabled = false);
        }
        calculate();
    }

    function calculate() {
        const dailyKm = Number(document.getElementById('dailyKm').value);
        const daysWeek = Number(document.getElementById('daysPerWeek').value);
        const annualKm = dailyKm * daysWeek * 52;

        const bikeBody = Number(document.getElementById('bikeBodyPrice').value);
        const accPrice = Number(document.getElementById('accessoriesPrice').value);
        const amortYears = Number(document.getElementById('amortYears').value) || 1;
        const depreciation = (bikeBody + accPrice) / amortYears;

        const jibaisekiTotal = Number(document.getElementById('jibaisekiPrice').value);
        const jibaisekiYears = Number(document.getElementById('jibaisekiYears').value);
        const jibaisekiYearly = jibaisekiTotal / jibaisekiYears;
        const arbitraryIns = Number(document.getElementById('arbitraryInsurance').value);
        const tax = Number(document.getElementById('taxYearly').value);
        const parkMonth = Number(document.getElementById('parkMonthly').value);
        const parkRenewal = Number(document.getElementById('parkRenewalYearly').value);
        const parkingYearly = (parkMonth * 12) + parkRenewal;
        const fixedYearly = depreciation + jibaisekiYearly + arbitraryIns + tax + parkingYearly;

        const gasPrice = Number(document.getElementById('gasPrice').value);
        const mpg = Number(document.getElementById('mpg').value) || 1;
        const fuelYearly = (annualKm / mpg) * gasPrice;

        const isShop = document.getElementById('shopToggle').checked;
        let partsYearly = 0;
        
        partsData.forEach(p => {
            if (p.optional && document.getElementById(p.id + '_disabled').checked) return; 

            const labor = isShop ? Number(document.getElementById(p.id + '_labor').value) : 0;
            const lifeVal = Number(document.getElementById(p.id + '_life').value) || 1;
            
            let materialCost = 0;
            if(p.type === 'liquid') {
                const buyPrice = Number(document.getElementById(p.id + '_buyPrice').value);
                const buyVol = Number(document.getElementById(p.id + '_buyVol').value) || 1;
                const useVol = Number(document.getElementById(p.id + '_useVol').value);
                materialCost = (buyPrice / buyVol) * useVol;
            } else {
                materialCost = Number(document.getElementById(p.id + '_cost').value);
            }
            
            const oneTimeCost = materialCost + labor;

            if (p.mode === 'time') {
                partsYearly += oneTimeCost / lifeVal;
            } else {
                partsYearly += (oneTimeCost / lifeVal) * annualKm;
            }
        });

        const totalYearly = fixedYearly + fuelYearly + partsYearly;
        const costPerKm = annualKm > 0 ? totalYearly / annualKm : 0;

        document.getElementById('resAnnualKm').innerText = Math.round(annualKm).toLocaleString() + ' km';
        document.getElementById('resTotalYear').innerText = Math.round(totalYearly).toLocaleString() + ' å††';
        document.getElementById('resCostPerMonth').innerText = Math.round(totalYearly/12).toLocaleString() + ' å††';
        document.getElementById('resCostPerDay').innerText = Math.round(totalYearly/(daysWeek*52)).toLocaleString() + ' å††';
        document.getElementById('resCostPerKm').innerText = (Math.round(costPerKm * 10) / 10).toLocaleString() + ' å††';
    }

    function updateNameDisplay() {
        const inputVal = document.getElementById('myBikeNameInput').value;
        const display = document.getElementById('displayBikeName');
        display.innerText = inputVal === '' ? 'YOUR BIKE' : inputVal;
    }

    function takeScreenshot() {
        const target = document.getElementById('resultBox');
        html2canvas(target, { scale: 2, backgroundColor: "#263238" }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'bike_cost_result_pro_final.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function toggleSection(el) {
        el.classList.toggle('active');
        el.nextElementSibling.classList.toggle('open');
    }
    function toggleShopMode() {
        const isShop = document.getElementById('shopToggle').checked;
        document.querySelectorAll('.labor-row').forEach(row => {
            row.style.display = isShop ? 'flex' : 'none';
        });
        calculate();
    }

    init();
</script>

</body>
</html>