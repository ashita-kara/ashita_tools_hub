<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ãƒã‚¤ã‚¯åŠ é€Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif; 
            margin: 0; padding: 15px; background-color: #f0f2f5; color: #1a1a1a; padding-bottom: 60px; 
        }
        h2 { font-size: 1.2rem; margin: 0 0 15px 0; padding-bottom: 10px; border-bottom: 2px solid #0056b3; color: #0056b3; }
        
        .control-panel { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
        .control-group { background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        
        /* ã‚°ãƒ«ãƒ¼ãƒ—è‰²åˆ†ã‘ */
        .group-bike { border-left: 6px solid #2196F3; }
        .group-tune { border-left: 6px solid #9C27B0; }
        .group-weight { border-left: 6px solid #FF9800; }
        .group-cond { border-left: 6px solid #4CAF50; }

        label { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-weight: 700; font-size: 0.9rem; color: #444; }
        select { width: 100%; padding: 12px; font-size: 1rem; border: 1px solid #ddd; border-radius: 8px; background-color: #f9f9f9; }
        input[type="range"] { width: 100%; height: 25px; margin: 5px 0; cursor: pointer; accent-color: #0056b3; }
        input[type="checkbox"] { transform: scale(1.5); accent-color: #9C27B0; }

        .val-display { font-size: 1.1em; color: #0056b3; }
        .unit { font-size: 0.85em; color: #666; font-weight: normal; }

        /* çµæœãƒ‘ãƒãƒ« */
        #results-area { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        
        /* çµæœã®è¡Œè¨­å®š */
        .result-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .res-box { background: #fff; padding: 12px 5px; border-radius: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .res-label { font-size: 0.75rem; color: #666; display: block; margin-bottom: 3px; }
        .res-val { font-size: 1.3rem; font-weight: 800; color: #333; }
        .res-unit { font-size: 0.8rem; font-weight: normal; }
        
        /* è·é›¢è¨ˆæ¸¬ç”¨ã¯å°‘ã—è‰²ã‚’å¤‰ãˆã‚‹ */
        .res-dist .res-val { color: #d84315; } 

        /* ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ */
        .chart-container { 
            position: relative; width: 100%; height: 40vh; min-height: 300px; 
            background: #fff; border-radius: 12px; padding: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .toggle-row { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; }
        .tune-desc { font-size: 0.8rem; color: #666; margin-top: -5px; margin-bottom: 10px; }
    </style>
</head>
<body>

<h2>ğŸ›µ åŠ é€Ÿã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>

<div id="results-area">
    <div class="result-row">
        <div class="res-box">
            <span class="res-label">0-30km/h åˆ°é”</span>
            <span id="time30" class="res-val">-</span> <span class="res-unit">ç§’</span>
        </div>
        <div class="res-box">
            <span class="res-label">0-60km/h åˆ°é”</span>
            <span id="time60" class="res-val">-</span> <span class="res-unit">ç§’</span>
        </div>
    </div>

    <div class="result-row">
        <div class="res-box res-dist">
            <span class="res-label">ğŸš© 0-500m é€šé</span>
            <span id="time500m" class="res-val">-</span> <span class="res-unit">ç§’</span>
        </div>
        <div class="res-box res-dist">
            <span class="res-label">ğŸ 0-1km é€šé</span>
            <span id="time1km" class="res-val">-</span> <span class="res-unit">ç§’</span>
        </div>
    </div>
</div>

<div class="chart-container">
    <canvas id="accelChart"></canvas>
</div>
<p style="text-align:center; font-size:0.8rem; color:#888;">ã‚°ãƒ©ãƒ•: æ¨ªè»¸=ç§’æ•° / ç¸¦è»¸=é€Ÿåº¦km/h</p>

<div class="control-panel">
    
    <div class="control-group group-bike">
        <label>è»Šç¨®ãƒ—ãƒªã‚»ãƒƒãƒˆ</label>
        <select id="bikePreset">
            <option value="">-- ã‚«ã‚¹ã‚¿ãƒ  (æ‰‹å‹•) --</option>
            <optgroup label="HONDA">
                <option value='{"w":132, "p":12.5}'>PCX125</option>
                <option value='{"w":132, "p":15.8}'>PCX160</option>
                <option value='{"w":136, "p":16.0}'>ADV160</option>
                <option value='{"w":116, "p":11.0}'>ãƒªãƒ¼ãƒ‰125</option>
                <option value='{"w":96, "p":8.7}'>Dio110</option>
                <option value='{"w":110, "p":7.9}'>ãƒ™ãƒ³ãƒªã‚£110</option>
                <option value='{"w":139, "p":4.6}'>ã‚¸ãƒ£ã‚¤ãƒ­ã‚­ãƒ£ãƒãƒ”ãƒ¼ (50cc)</option>
                <option value='{"w":113, "p":4.6}'>ã‚¸ãƒ£ã‚¤ãƒ­X (50cc)</option>
                <option value='{"w":110, "p":9.8}'>ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚«ãƒ– C125</option>
                <option value='{"w":118, "p":9.1}'>CT125 ãƒãƒ³ã‚¿ãƒ¼ã‚«ãƒ–</option>
                <option value='{"w":162, "p":14.5}'>FORZA 125</option>
                <option value='{"w":79, "p":4.5}'>ã‚¿ã‚¯ãƒˆ/ãƒ€ãƒ³ã‚¯ (50cc)</option>
                <option value='{"w":87, "p":4.2}'>ã‚ºãƒ¼ãƒãƒ¼</option>
            </optgroup>
            <optgroup label="YAMAHA">
                <option value='{"w":131, "p":12.0}'>NMAX 125</option>
                <option value='{"w":131, "p":15.0}'>NMAX 155</option>
                <option value='{"w":168, "p":12.0}'>ãƒˆãƒªã‚·ãƒ†ã‚£ 125</option>
                <option value='{"w":172, "p":15.0}'>ãƒˆãƒªã‚·ãƒ†ã‚£ 155</option>
                <option value='{"w":125, "p":12.0}'>ã‚·ã‚°ãƒŠã‚¹ ã‚°ãƒªãƒ•ã‚¡ã‚¹/X FORCE</option>
                <option value='{"w":78, "p":4.5}'>JOG/VINO (50cc)</option>
                <option value='{"w":95, "p":8.3}'>JOG 125/ã‚¢ã‚¯ã‚·ã‚¹Z</option>
            </optgroup>
            <optgroup label="SUZUKI">
                <option value='{"w":105, "p":8.7, "b":1.0}'>ã‚¢ãƒ‰ãƒ¬ã‚¹125 (ç¾è¡Œ)</option>
                <option value='{"w":107, "p":8.7, "b":1.1}'>ã‚¢ãƒ´ã‚§ãƒ‹ã‚¹125 (åŠ é€Ÿé‡è¦–)</option>
                <option value='{"w":100, "p":8.8}'>ã‚¢ãƒ‰ãƒ¬ã‚¹110</option>
                <option value='{"w":70, "p":3.7}'>ãƒ¬ãƒƒãƒ„ (50cc)</option>
                <option value='{"w":112, "p":8.6}'>ãƒãƒ¼ã‚°ãƒãƒ³ã‚¹ãƒˆãƒªãƒ¼ãƒˆ125EX</option>
            </optgroup>
        </select>
    </div>

    <div class="control-group group-tune">
        <label>
            <span>ğŸ”§ WRé‡é‡ã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°</span>
            <span class="val-display"><span id="val-wr">ç´”æ­£</span></span>
        </label>
        <input type="range" id="wrWeight" min="-3" max="3" step="0.5" value="0">
        <div class="tune-desc">å·¦: è»½ã„ (åŠ é€Ÿé‡è¦–) â‡” å³: é‡ã„ (ç‡ƒè²»é‡è¦–)</div>

        <div class="toggle-row">
            <label style="margin:0; width:auto;">
                <span style="display:flex; align-items:center; gap:5px;">
                    âš¡ Dr.Pulley (ç•°å½¢ãƒ­ãƒ¼ãƒ©ãƒ¼)
                </span>
            </label>
            <input type="checkbox" id="drPulley">
        </div>
        <div class="tune-desc" style="margin-top:5px;">ONã§å¤‰é€Ÿå¹…æ‹¡å¤§(åŠ é€Ÿ&æœ€é«˜é€Ÿå¾®å¢—)</div>
    </div>

    <div class="control-group group-weight">
        <label>
            <span>ğŸ› ï¸ ã‚¢ã‚¯ã‚»é‡é‡ <span class="unit">(å›ºå®š)</span></span>
            <span class="val-display"><span id="val-acc">5</span> <span class="unit">kg</span></span>
        </label>
        <input type="range" id="accWeight" min="0" max="30" step="0.5" value="5">
        
        <hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">

        <label>
            <span>ğŸ” å•†å“é‡é‡ <span class="unit">(å¤‰å‹•)</span></span>
            <span class="val-display"><span id="val-cargo">0</span> <span class="unit">kg</span></span>
        </label>
        <input type="range" id="cargoWeight" min="0" max="60" step="0.5" value="0">
    </div>

    <div class="control-group group-cond">
        <label>â›°ï¸ å‚é“è§’åº¦: <span class="val-display" id="val-slope">0</span> åº¦</label>
        <input type="range" id="slope" min="-5" max="15" step="0.5" value="0">
        
        <label style="margin-top:10px;">ğŸ”§ æ¶ˆè€—åº¦: <span id="val-wear-text" style="font-size:0.9rem;">æ–°å“</span></label>
        <input type="range" id="wearLevel" min="0" max="30" step="1" value="0">
        
        <label style="margin-top:10px;">ğŸ› ã‚¿ã‚¤ãƒ¤: <span id="val-tire-text" style="font-size:0.9rem;">é©æ­£</span></label>
        <input type="range" id="tireCondition" min="0" max="3" step="1" value="0">
    </div>

    <div style="display:none;">
        <input type="number" id="bikeWeight" value="130">
        <input type="number" id="powerPS" value="12.5">
    </div>
</div>

<script>
    const ctx = document.getElementById('accelChart').getContext('2d');
    let chart;
    let bikeBoost = 1.0;
    const G = 9.8; 
    const RHO = 1.225; 
    const CdA = 0.5; 

    // DOMè¦ç´ 
    const elPreset = document.getElementById('bikePreset');
    const elAcc = document.getElementById('accWeight');
    const elCargo = document.getElementById('cargoWeight');
    const elSlope = document.getElementById('slope');
    const elWear = document.getElementById('wearLevel');
    const elTire = document.getElementById('tireCondition');
    const elBikeW = document.getElementById('bikeWeight');
    const elPower = document.getElementById('powerPS');
    const elWR = document.getElementById('wrWeight');
    const elDrPulley = document.getElementById('drPulley');

    function updateLabels() {
        document.getElementById('val-acc').textContent = elAcc.value;
        document.getElementById('val-cargo').textContent = elCargo.value;
        document.getElementById('val-slope').textContent = elSlope.value;

        const wrVal = parseFloat(elWR.value);
        let wrText = "ç´”æ­£ (Â±0g)";
        if(wrVal > 0) wrText = `é‡ã‚ (+${wrVal}g)`;
        if(wrVal < 0) wrText = `è»½ã‚ (${wrVal}g)`;
        document.getElementById('val-wr').textContent = wrText;

        const wear = parseInt(elWear.value);
        document.getElementById('val-wear-text').textContent = wear > 15 ? "åŠ£åŒ–" : "æ­£å¸¸";
        document.getElementById('val-tire-text').textContent = parseInt(elTire.value) >= 2 ? "å±é™º" : "é©æ­£";
    }

    elPreset.addEventListener('change', function() {
        if (this.value) {
            const data = JSON.parse(this.value);
            elBikeW.value = data.w;
            elPower.value = data.p;
            bikeBoost = data.b || 1.0;
            updateChart();
        }
    });

    function calculate() {
        updateLabels();

        const slopeDeg = parseFloat(elSlope.value);
        const accW = parseFloat(elAcc.value);
        const cargoW = parseFloat(elCargo.value);
        const bikeW = parseFloat(elBikeW.value);
        const riderW = 65; 
        const totalMass = bikeW + riderW + accW + cargoW;
        const powerPS = parseFloat(elPower.value);
        const powerWatts = powerPS * 735.5; 
        const slopeRad = slopeDeg * (Math.PI / 180);

        // ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ä¿‚æ•°
        const wrSetting = parseFloat(elWR.value);
        const lowSpeedBoost = 1.0 - (wrSetting * 0.02); 
        const highSpeedLoss = 1.0 + (wrSetting * 0.015); 
        const useDrPulley = elDrPulley.checked;
        const drPulleyBonus = useDrPulley ? 1.05 : 1.0; 

        // æ¶ˆè€—ãƒ»æŠµæŠ—ä¿‚æ•°
        const wearFactor = parseFloat(elWear.value) / 100;
        const currentEfficiency = 0.85 - (wearFactor * 0.5);
        const tireLevel = parseInt(elTire.value);
        const rollingResistCoef = 0.02 + (tireLevel * 0.012);

        let velocity = 0; 
        let time = 0;
        let dist = 0; // èµ°è¡Œè·é›¢ (m)
        let dataPoints = [];
        
        let timeTo30 = null;
        let timeTo60 = null;
        let timeTo500m = null; // 0-500m
        let timeTo1km = null;  // 0-1000m
        
        const dt = 0.1;
        let lastV = -1;
        let stuckCount = 0;

        // ãƒ«ãƒ¼ãƒ—ä¸Šé™ã‚’120ç§’ã«å»¶é•· (50ccãªã©ã§1kmèµ°ã‚‹ãŸã‚)
        while (time <= 120 && velocity * 3.6 < 120) {
            let vKmh = velocity * 3.6;
            dataPoints.push({x: time.toFixed(1), y: vKmh});

            // ã‚¿ã‚¤ãƒ è¨ˆæ¸¬
            if (timeTo30 === null && vKmh >= 30) timeTo30 = time;
            if (timeTo60 === null && vKmh >= 60) timeTo60 = time;

            // è·é›¢è¨ˆæ¸¬
            if (timeTo500m === null && dist >= 500) timeTo500m = time;
            if (timeTo1km === null && dist >= 1000) timeTo1km = time;

            if (Math.abs(vKmh - lastV) < 0.01) {
                stuckCount++; 
                // 1kmåˆ°é”ã—ã¦ã„ãªã„å ´åˆã¯ã€æœ€é«˜é€Ÿã®ã¾ã¾èµ°ã‚Šç¶šã‘ã‚‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚breakã—ãªã„
                // ãŸã ã—é•·æ™‚é–“å¤‰åŒ–ãªã—ãªã‚‰ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆå‰Šæ¸›ã®ãŸã‚é–“å¼•ããŸã„ãŒã€
                // ç°¡æ˜“çš„ã«1kmåˆ°é”ã‹120ç§’ã¾ã§ã¯å›ã™
            } 
            lastV = vKmh;

            // é§†å‹•åŠ›è¨ˆç®—
            let driveForce;
            if (velocity < 3) { 
                driveForce = (powerWatts * currentEfficiency / 2.5); 
            } else {
                driveForce = (powerWatts * currentEfficiency) / velocity;
                let maxForce = 3500 * currentEfficiency; 
                if(driveForce > maxForce) driveForce = maxForce;
            }

            // ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°åæ˜ 
            if (vKmh < 45) driveForce *= lowSpeedBoost;
            else if (vKmh > 60) driveForce *= highSpeedLoss; 
            driveForce *= bikeBoost;
            driveForce *= drPulleyBonus;
            if (useDrPulley && vKmh > 70) driveForce *= 1.05; 

            // æŠµæŠ—è¨ˆç®—
            const gravityF = totalMass * G * Math.sin(slopeRad);
            const airF = 0.5 * RHO * CdA * (velocity * velocity);
            const rollF = totalMass * G * rollingResistCoef * Math.cos(slopeRad);

            const netForce = driveForce - (gravityF + airF + rollF);
            let accel = netForce / totalMass;
            if (accel < 0) accel = 0;

            velocity += accel * dt;
            dist += velocity * dt; // è·é›¢åŠ ç®—
            time += dt;
        }

        // è¡¨ç¤ºæ›´æ–°
        document.getElementById('time30').textContent = timeTo30 ? timeTo30.toFixed(2) : "-";
        document.getElementById('time60').textContent = timeTo60 ? timeTo60.toFixed(2) : "-";
        
        // è·é›¢ã‚¿ã‚¤ãƒ æ›´æ–°
        document.getElementById('time500m').textContent = timeTo500m ? timeTo500m.toFixed(1) : "ä¸å¯";
        document.getElementById('time1km').textContent = timeTo1km ? timeTo1km.toFixed(1) : "ä¸å¯";

        return dataPoints;
    }

    function updateChart() {
        const data = calculate();
        if (chart) {
            chart.data.datasets[0].data = data;
            // è»¸ã®è‡ªå‹•èª¿æ•´ï¼ˆæ™‚é–“ãŒé•·ã„å ´åˆã«ã‚°ãƒ©ãƒ•ãŒè¦‹ã«ãããªã‚‹ã®ã‚’é˜²ããŸã‚ã€ãƒ‡ãƒ¼ã‚¿é•·ã«åˆã‚ã›ã¦æœ€å¤§å€¤ã‚’å¯å¤‰ã«ï¼‰
            const maxTime = parseFloat(data[data.length-1].x);
            chart.options.scales.x.max = maxTime > 25 ? maxTime : 25;
            chart.update();
        } else {
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'é€Ÿåº¦æ¨ç§»',
                        data: data,
                        borderColor: '#9C27B0',
                        backgroundColor: 'rgba(156, 39, 176, 0.1)',
                        borderWidth: 3,
                        pointRadius: 0,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { type: 'linear', min: 0, max: 25, title: {display:true, text:'çµŒéæ™‚é–“ (ç§’)'}, grid: {color: '#e0e0e0'} },
                        y: { min: 0, max: 100, title: {display:true, text:'é€Ÿåº¦ (km/h)'}, grid: {color: '#e0e0e0'} }
                    },
                    plugins: { legend: {display: false}, tooltip: {mode: 'index', intersect: false} },
                    animation: false,
                    interaction: { intersect: false, mode: 'nearest' }
                }
            });
        }
    }

    document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('input', updateChart);
    });

    updateChart();
</script>

</body>
</html>